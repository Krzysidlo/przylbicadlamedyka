function loadScript(e,a){var n=document.getElementsByTagName("head")[0],t=document.createElement("script");t.type="text/javascript",t.src=JS_URL+"/"+e,t.onreadystatechange=a,t.onload=a,n.appendChild(t)}var index=function(){function e(e,a,n){a=a||"danger",n=void 0!==n?n:3e3;var t=$("<div>").addClass("kjtoast hidden alert alert-"+a);if(t.html(e),t.appendTo($("body .toastContainer")),t.fadeIn(),n>0){var o=setTimeout(function(){t.fadeOut(function(){t.remove()})},n);t.on("mouseenter",function(){clearTimeout(o)}).on("mouseleave",function(){o=setTimeout(function(){t.fadeOut(function(){t.remove()})},3e3)}).on("click",function(){clearTimeout(o),t.fadeOut(function(){t.remove()})})}return t}function a(){$("#loading").fadeIn()}function n(){$("#loading").fadeOut()}function t(){i.fadeIn(),$("body").addClass("no_scroll"),setTimeout(function(){o()},7e3)}function o(){i.fadeOut();$("body").removeClass("no_scroll")}var i=$("#preloader");$(window).on("load",function(){o()}),$(function(){var i=$("body");$(document).trigger("scroll"),!function(){var e=!1;return function(a){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e}()&&i.height()>$(window).height()&&i.addClass("desktop"),function(){var e,a=$("body"),n=$("nav.navbar"),t=n.find(".navbar-toggler"),o=n.find(".navbar-collapse"),i=n.find(".notifications");t.on("click",function(){o.hasClass("show")?a.removeClass("collapsed"):a.addClass("collapsed")}),i.find("#notifications").on("click",function(){e=setTimeout(function(){$.ajax({url:"/ajax/notifications.php?ajax=true",data:{action:"read"},type:"POST",dataType:"JSON",success:function(e){e.success&&i.find("#notifications .num").html("0").removeClass("new")}})},1500)}).on("blur",function(){clearTimeout(e)}),i.find(".dropdown-menu a.dropdown-item").on("click",function(e){var n=$(this).attr("href"),o=window.location.pathname,i=n.split("#");shouldPrevent="#"===n,shouldPrevent&&e.preventDefault(),shouldPrevent|=n.indexOf("#")>=0&&i[0]==o,shouldPrevent&&(e.stopPropagation(),a.hasClass("collapsed")&&t.trigger("click"))})}(),$(".dropdown #change + .dropdown-menu .dropdown-item").on("click",function(){$(this).closest("form").submit()}),function(){if($("section.loginRegister").length<=0){var a=$("#surpriseModal"),n=$("#cheatingModal"),t=a.find("img.img-responsive"),o=$("[class^=srp]"),r=!1;n.on("show.bs.modal",function(){var e=n.find(".modal-content .modal-body .img-responsive"),a=Math.floor(2*Math.random())+1;e.attr("src",e.data("src")+a+e.data("ext"))}),o.on("click",function(n){n.preventDefault();var o=$(this);if(o.hasClass("active")){var s=o.attr("class").split(" ")[0].substr(3);r=!0,t.attr("src",t.data("srp")+s+t.data("ext")),a.modal("show"),$.ajax({url:"/ajax/picture_found.php?ajax=true",data:{number:s},type:"POST",dataType:"JSON",success:function(e){if(e.success&&e.modal&&e.modalId){var n=$("#"+e.modalId);a.on("hidden.bs.modal",function(){n.length<=0&&(i.append($(e.modal)),n=$("#"+e.modalId)),n.modal("show"),n.on("shown.bs.modal",function(){a.off("hidden.bs.modal")})})}switch(e.success){case"foundAll":r=!0,$(".pagin .pagination .page-item [class^=srp]").addClass("active")}},error:function(){e("Ajax error","danger")}})}});var s=new MutationObserver(function(e){e.forEach(function(e){if("class"===e.attributeName){var a=$(e.target);r?r=!1:(a.removeClass("active"),n.modal("show"))}})}),c=new MutationObserver(function(e){e.forEach(function(e){"src"===e.attributeName&&(r?r=!1:(r=!0,t.attr("src",""),a.modal("hide"),setTimeout(function(){n.modal("show")},600)))})});"Node"==typeof t[0]&&c.observe(t[0],{attributes:!0}),o.each(function(e,a){s.observe(a,{attributes:!0})})}}(),$(document).on("click",".preload",function(e){$(e);t(),setTimeout(function(){o()},5e3)}).on("keydown",function(e){116===e.which&&t()}),function(){var t=$("body.settings");if(t.length){var o=t.find(".form form"),i=o.find("input[name='darkTheme']"),r=o.find("input[name='pushNotifications']"),s=o.find("input[name='parallax']"),c=o.find("input[name='parallaxUrl']"),d=o.find("input[name='avatar']"),l=o.find("label[for='avatar']"),u=o.find("input[name='gravatar']"),f=d.parent(),p=f.find("#profile"),m=t.find("#source");o.on("submit",function(t){t.preventDefault(),function(t){var o=new FormData(t.get(0));o.append("saveSettings",!0),$.ajax({url:t.attr("action")+"?ajax=true",type:"POST",data:o,dataType:"JSON",processData:!1,contentType:!1,beforeSend:function(){a()},success:function(a){e(a.message,a.alert)},error:function(){e("Ajax error","danger")},complete:function(){n()}})}(o)}),i.on("change",function(){var e=$("link.theme");$(this).prop("checked")?(e.attr("href",e.data("dark")),$("nav.navbar").removeClass("navbar-light bg-light").addClass("navbar-dark bg-dark")):(e.attr("href",e.data("light")),$("nav.navbar").removeClass("navbar-dark bg-dark").addClass("navbar-light bg-light"))}),r.on("change",function(){var e=$(this);e.prop("checked")&&(Push.Permission.has()||"denied"===Push.Permission.get()?Push.Permission.has()||(e.prop("checked",!1),notifyDenied()):Push.Permission.request(subscribePushManager(),notifyDenied()))}),s.on("change",function(){$(this).prop("checked")?c.parent().fadeIn():c.parent().fadeOut()});var v=c.parent().find("i.fa");v.hasClass("active")&&v.removeClass("active"),c.on("blur",function(){v.removeClass("active")}),u.on("change",function(){var e=d.parents(".avatarParent");$(this).prop("checked")?e.fadeOut():e.fadeIn()}),l.on("click",function(e){e.preventDefault(),m.modal("show")});var g=!1;m.on("click",".option.capture",function(e){e.preventDefault(),g=!0,m.modal("hide")}).on("click",".option.upload",function(e){e.preventDefault(),m.modal("hide"),d.trigger("click")}).on("hidden.bs.modal",function(){g&&(x.modal("show"),navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(function(e){k=e,T.srcObject=e,T.play()}).catch(function(e){console.log("error",e)}),g=!1)});var h="";d.on("change",function(){var e=new FileReader;this.files&&this.files[0]?(h=this.files,e.onload=function(e){p.attr("src",e.target.result),f.find(".removePic").removeClass("hidden"),f.find("input[name='save_avatar']").val("true")},e.readAsDataURL(h[0])):d.prop("files",h)});var b=!1;f.on("drag dragstart dragend dragover dragenter dragleave drop",function(e){e.preventDefault(),e.stopPropagation()}).on("dragover dragenter",function(){f.addClass("drag")}).on("dragleave dragend drop",function(){f.removeClass("drag")}).on("drop",function(a){(b=a.originalEvent.dataTransfer.files).length>=2?(w(f.find(".removePic")),e(d.data("tmf"),"warning")):(d.prop("files",b),d.trigger("change"))}),f.find(".removePic").on("click",function(){w($(this))});var w=function(e){e.addClass("hidden"),d.val(""),f.find("input[name='save_avatar']").val(""),p.attr("src",d.data("default")),h="",d.prop("files",h)};t.find("#recountPoints").on("click",function(t){t.preventDefault(),$.ajax({url:"/ajax/recalculate_points.php?ajax=true",type:"POST",dataType:"JSON",beforeSend:function(){a()},success:function(a){a.alert&&e(a.message,a.alert)},error:function(){e("Ajax error","danger")},complete:function(){n()}})});var y,k,x=t.find("#camera"),j=x.find("img.preview"),T=x.find("video.camera_stream")[0],P=$(T).parents(".box"),O=j.parents(".box"),C=x.find(".capture"),S=x.find(".again"),D=x.find(".save");D.hide(),S.hide(),C.on("click",function(e){e.preventDefault();var a=$(this),n=x.find("canvas.snapshot")[0],t=T.videoWidth,o=T.videoHeight,i=n.getContext("2d");n.width=t,n.height=o,i.drawImage(T,0,0,t,o),y=n.toDataURL("image/jpg"),j.attr("src",y),P.hide(),O.show(),a.hide(),S.show(),D.show()}),S.on("click",function(e){e.preventDefault(),P.show(),O.hide(),C.show(),S.hide(),D.hide()}),x.on("hidden.bs.modal",function(){var e=k.getTracks()[0];j.attr("src","data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="),e.stop(),S.trigger("click")}),D.on("click",function(t){t.preventDefault(),$.ajax({url:"/ajax/save_picture.php?ajax=true",type:"POST",data:{file:y},dataType:"JSON",beforeSend:function(){a()},success:function(a){a.success?(p.attr("src",a.picture+"?date="+Date.now()),f.find(".removePic").removeClass("hidden"),f.find("input[name='save_avatar']").val("capture")):a.alert&&e(a.message,a.alert),x.modal("hide")},error:function(){e("Wystąpił błąd podczas przetwarzania zdjęcia, przepraszamy.","danger"),x.modal("hide")},complete:function(){n()}})});var z=t.find("#changePasswordModal"),A=t.find("#changePassword"),N=z.find("form"),I=z.find("button[type='submit']");A.on("click",function(e){e.preventDefault(),z.modal("show")}),I.on("click",function(t){t.preventDefault();var o=N.get(0),i=new FormData(o);i.append("changePassword",!0),$.ajax({url:N.attr("action")+"?ajax=true",type:"POST",data:i,dataType:"JSON",processData:!1,contentType:!1,beforeSend:function(){a()},success:function(a){if(a.success)z.modal("hide");else{var n=a.field.split(",");$(n).each(function(e,a){N.find('input[name="'+a+'"]').removeClass("valid").addClass("invalid").trigger("focus")})}e(a.message,a.alert)},error:function(){e("Wystąpił błąd podczas próby zmiany hasła. Proszę odświeżyć stronę i spróbować ponownie","danger")},complete:function(){n()}})}),z.on("hidden.bs.modal",function(e){N.find("input").val("").trigger("blur")});var J=t.find("#groupsModal"),_=J.find("input#groupName"),M=J.find("input#groupCode"),R=J.find("button#createJoin");M.on("keyup",function(e){if(13===e.which)return e.preventDefault(),R.trigger("click"),!1}),_.on("keyup",function(e){if(13===e.which)return e.preventDefault(),R.trigger("click"),!1;""===_.val()?R.removeClass("create"):R.addClass("create")}),R.on("click",function(a){a.preventDefault();var n=_.val(),t=M.val();if(""===n){if(""===t)return e("Proszę podać hasło do grupy, aby móc do niej dołączyć","warning"),!1;$.ajax({url:"/ajax/groups.php?ajax=true",type:"POST",data:{action:"join",code:t},dataType:"JSON",beforeSend:function(){R.addClass("loading")},success:function(a){if(a.success){$(a.newRow).insertBefore(J.find("table tr.form")).fadeIn(),_.val("").trigger("blur"),M.val("").trigger("blur")}a.alert&&e(a.message,a.alert)},error:function(){e("Ajax error","danger")},complete:function(){R.removeClass("loading")}})}else{if(""===t)return e("Proszę podać hasło dla nowej grupy o nazwie '"+n+"'","warning"),!1;$.ajax({url:"/ajax/groups.php?ajax=true",type:"POST",data:{action:"new",name:n,code:t},dataType:"JSON",success:function(a){if(a.success&&a.success){$(a.newRow).insertBefore(J.find("table tr.form")).fadeIn(),_.val("").trigger("blur"),M.val("").trigger("blur")}a.alert&&e(a.message,a.alert)},error:function(){e("Ajax error","danger")}})}}),J.find("table").on("click","button.leave",function(a){a.preventDefault();var n=$(this).parents("tr"),t=n.data("id");$.ajax({url:"/ajax/groups.php?ajax=true",type:"POST",data:{action:"leave",id:t},dataType:"JSON",success:function(a){a.success&&n.fadeOut(function(){n.remove()}),a.alert&&e(a.message,a.alert)},error:function(){e("Ajax error","danger")}})}),J.find("table").on("click","button.delete",function(a){if(a.preventDefault(),!confirm("UWAGA! Usunięcie grupy jest nieodwracalne. Spoowoduje to, że wszyscy użytkownicy, którzy są do niej przypisani zostaną z niej usunięci. Czy na pewno chcesz to zrobić?"))return!1;var n=$(this).parents("tr"),t=n.data("id");$.ajax({url:"/ajax/groups.php?ajax=true",type:"POST",data:{action:"delete",id:t},dataType:"JSON",success:function(a){a.success&&n.fadeOut(function(){n.remove()}),a.alert&&e(a.message,a.alert)},error:function(){e("Ajax error","danger")}})})}}(),function(){var t=$("body.register");if(t.length){var o=$("#forgotPassword"),i=o.find("form");t.find(".logRegForm form").on("submit",function(e){e.preventDefault(),r($(this))}),o.on("show.bs.modal",function(){var e=t.find("input[name='lemail']").val();e.length&&o.find("#femail").val(e)}).on("shown.bs.modal",function(){o.find("#femail").trigger("focus")}),i.on("submit",function(t){t.preventDefault();var i=$(this),r=new FormData(i.get(0));r.append("forgotPassword",!0),$.ajax({url:i.attr("action")+"?ajax=true",type:"POST",data:r,dataType:"JSON",processData:!1,contentType:!1,beforeSend:function(){a()},success:function(a){a.success&&o.modal("hide"),e(a.message,a.alert)},error:function(){e("Ajax error","danger")},complete:function(){n()}})});var r=function(t){var o=new FormData(t.get(0));$.ajax({url:t.attr("action")+"?ajax=true",type:"POST",data:o,dataType:"JSON",processData:!1,contentType:!1,beforeSend:function(){a()},success:function(a){a.success&&(location.href="/"),a.alert&&e(a.message,a.alert)},error:function(){e("Ajax error","danger")},complete:function(){n()}})}}}(),setInterval(function(){$.ajax({url:"/ajax/notifications.php?ajax=true",type:"POST",data:{action:"get"},dataType:"JSON",success:function(e){if(e.success){var a=e.data;for(var n in a){var t=$("<a>");t.addClass("dropdown-item waves-effect waves-light active"),null!=a[n].href?(t.attr("href",a[n].href),t.addClass("preload")):t.attr("href","#"),t.html(a[n].content),t.prependTo("nav.navbar .notifications .dropdown-menu");var o=$("nav.navbar #notifications span.num");o.html(parseInt(o.html())+1),o.addClass("new")}}}})},1e4),function(){var t=$("body.privileges");if(t.length){var o=t.find("form.setPrivileges"),i=o.find("#usersID"),r=o.find("#level"),s={placeholder:"Wybierz użytkownika",allowClear:!0},c={placeholder:"Wybierz uprawnienie",minimumResultsForSearch:-1,allowClear:!0};i.select2(s),r.select2(c),i.on("change",function(){var e=i.find("option:selected");priv=e.data("priv"),r.val(priv),r.select2("destroy"),r.select2(c)}),o.on("submit",function(t){t.preventDefault();var c=o.get(0),d=new FormData(c);d.append("savePrivileges",!0),$.ajax({url:o.attr("action")+"?ajax=true",type:"POST",data:d,dataType:"JSON",processData:!1,contentType:!1,beforeSend:function(){a()},success:function(a){if(a.success){var n=i.find("option:selected"),t=r.val(),o=n.text(),c=o.lastIndexOf("("),d=o.substr(0,c)+"("+t+")";n.text(d),n.data("priv",t),n.attr("data-priv",t),i.select2("destroy"),i.select2(s)}e(a.message,a.alert)},error:function(){e("Ajax error","danger")},complete:function(){n()}})})}}()}),$.fn.isInViewport=function(){var e=$(this),a=e.offset().top,n=a+e.outerHeight(),t=$(window).scrollTop()-55,o=t+$(window).height();return n>t&&a<o&&n<o&&a>t}};loadScript("external.min.js",index);